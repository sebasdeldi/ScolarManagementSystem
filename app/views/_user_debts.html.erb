<ul class="nav nav-tabs">
  <li class="active">
    <a href="#1" data-toggle="tab">Información</a>
  </li>
  <% if user.has_role? :student%>
  	<li>
  		<a href="#2" data-toggle="tab">Deudas <span class="badge"><%= debts_array.nil? ? '0' : debts_array.count %></span></a>
  	</li>
  <% end %>
</ul>

<div class="tab-content ">
	<div class="tab-pane active" id="1">
		<h1><%= user.username %></h1>
		<% if current_user.has_role? :admin %>
			<h4>Logged as admin</h4>
		<% elsif current_user.has_role? :teacher %>
			<h4>Logged as teacher</h4>
		<% else %>
			<h4>Logged as student</h4>
		<% end %>
	</div>

	<div class="tab-pane" id="2">
		<% if debts_array.nil? %>
			<h1>No hay deudas.</h1>
		<% else %>
			<table class="table table-hover">
				<thead>
					<tr>
						<th>Fecha de la deuda</th>
						<% if current_user.has_role? :admin %>
							<th>Eliminar deuda</th>
						<% end %>
					</tr>
				</thead>
			    <tbody>
			    	<% debts_array.each do |debt| %>
				        <tr>
				          <td><%= debt %></td>
				          <% if current_user.has_role? :admin %>
				          	<td>
				          		<%= form_tag( user, :method => "post", authenticity_token: false) do %>
				          			<%= hidden_field_tag 'delete', debt %>
				          			<%= button_tag :submit, class: "delete-cross" do %>
				          			    <i class="glyphicon glyphicon-remove red"></i>
				          			<% end %>
				          		<%end%>
				          	</td>
				          <% end %>
				        </tr>
			    	<% end %>
			    </tbody>
			</table>
		<% end %>
		<% if current_user.has_role? :admin %>
			<button type="button" class="btn btn-danger fixedbutton" data-toggle="modal" data-target="#debt-modal">Agregar Deuda</button>

			<!-- Modal -->
			<div class="modal fade" id="debt-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title" id="myModalLabel">Agregar Deuda</h4>
						</div>
						<%= form_for user do |f| %>
							<div class="modal-body">
								<div class="form-group">
									<% if user.debts.nil? %>
										<%= f.text_field :debts, class: "form-control input-lg", placeholder: "Selecciona mes y año", id: "datepicker"%>
									<% else%>
										<%= f.text_field :add_debt, class: "form-control input-lg", placeholder: "Selecciona mes y año", id: "datepicker"%>
									<% end %>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
								<%= f.submit "Agregar Deuda", class: "btn btn-primary" %>
							</div>
						<% end %>
					</div>
				</div>
			</div>
		<% end %>
	</div>
</div>
<script type="text/javascript">
	// Since confModal is essentially a nested modal it's enforceFocus method
	// must be no-op'd or the following error results
	// "Uncaught RangeError: Maximum call stack size exceeded"
	// But then when the nested modal is hidden we reset modal.enforceFocus
	var enforceModalFocusFn = $.fn.modal.Constructor.prototype.enforceFocus;

	$.fn.modal.Constructor.prototype.enforceFocus = function() {};

	$confModal.on('hidden', function() {
	    $.fn.modal.Constructor.prototype.enforceFocus = enforceModalFocusFn;
	});

	$confModal.modal({ backdrop : false });
</script>
